# JNI Macros Quick Reference

This file is here for fun. We basically don't need this anymore because I asked
kimi to make a codegeneratorgen so toodles .V 

Clean macros for JNI bindings in `o19/crates/android`.

## Available Macros

### Exporting Rust to Java (Service-side)

```rust
use android::{jni_arg, jni_ret, with_service_or_throw};

#[no_mangle]
pub extern "C" fn Java_ty_circulari_o19_IFoundframeRadicle_Stub_nativeAddPost(
    mut env: jni:: JNIEnv,
    _class: jni::objects::JClass,
    content: jni::objects::JString,
    title: jni::objects::JString,
) -> jni::sys::jstring {
    // Get service or throw Java exception
    let service = with_service_or_throw!(env);
    
    // Convert JNI args to Rust types
    let content = jni_arg!(env, content: String);
    let title = jni_arg!(env, title: String);
    
    // Call your Rust implementation
    let result = service.add_post(&content, Some(&title));
    
    // Convert result back to JNI
    jni_ret!(env, result => String)
}
```

### Supported `jni_arg!` Types

| Rust Type | Java Type | Notes |
|-----------|-----------|-------|
| `String` | `String` | Converts JString to owned String |
| `&str` | `String` | Converts JString to string slice (limited lifetime) |
| `bool` | `boolean` | Converts jboolean to bool |
| `i32` | `int` | Passes through |
| `i64` | `long` | Passes through |

### Supported `jni_ret!` Types

| Rust Type | Java Type | Behavior on Error |
|-----------|-----------|-------------------|
| `String` | `String` | Throws RuntimeException, returns null |
| `&str` | `String` | Throws RuntimeException, returns null |
| `bool` | `boolean` | Throws RuntimeException, returns false |
| `i32` | `int` | Throws RuntimeException, returns 0 |
| `i64` | `long` | Throws RuntimeException, returns 0 |
| `()` | `void` | Throws RuntimeException |

### Calling Java from Rust (Client-side)

```rust
use android::{java_call, jni_to_rust, jni_type};
use jni::objects::JObject;
use jni::signature::JavaType;

// Get the Java service object (from ServiceConnection)
let service: JObject = /* ... */;

// Create JNI values for arguments  
let content_jstring = env.new_string("Hello")?;
let title_jstring = env.new_string("Title")?;

// Call Java method
let result = java_call!(
    env,
    service,
    "addPost",
    "(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;",
    [
        jni::objects::JValue::from(&content_jstring),
        jni::objects::JValue::from(&title_jstring)
    ]
)?;

// Convert result to Rust type
let reference: String = jni_to_rust!(env, result, String)?;
```

### Building JNI Signatures

```rust
use android::{jni_sig, jni_type};

// Simple signature macro
let sig = jni_sig!(String, String; String);  // (Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;

// Type helper
let bool_type = jni_type!(bool);     // "Z"
let int_type = jni_type!(int);       // "I"
let long_type = jni_type!(long);     // "J"
let string_type = jni_type!(String); // "Ljava/lang/String;"
let void_type = jni_type!(void);     // "V"
```

## File Organization

```
o19/crates/android/src/
├── lib.rs                 # Re-exports macros and modules
├── aidl_service.rs        # Service implementation + JNI exports
├── aidl_client.rs         # Client with JNI calls
└── jni_macros/
    ├── mod.rs             # Module docs
    ├── calls.rs           # java_call!, jni_sig!, jni_to_rust!
    ├── exports.rs         # jni_arg!, jni_ret!, with_service_or_throw!
    └── types.rs           # Type conversion traits (advanced)
```

## Architecture

```
Rust Code                              Java Code
─────────────────────────────────────────────────────────
#[no_mangle]                         IFoundframeRadicle.Stub
pub extern "C" fn ... {              nativeAddPost() {
  let service =                            ↓
    with_service_or_throw!();      JNI Call (JVM)
      ↓                                    ↓
  let content =                            ↓
    jni_arg!(env, content: String);   Rust Implementation
      ↓                                    ↓
  let result =                             ↓
    service.add_post(...);                ↓
      ↓                              Return String
  jni_ret!(env, result => String)          ↓
}                                    Return to Java caller
```

## Future: aidl-spiral Integration

The macros are designed to work with generated code. Example generated output:

```rust
// Generated by aidl-spiral
#[no_mangle]
pub extern "C" fn Java_ty_circulari_o19_..._nativeAddPost(
    mut env: JNIEnv,
    _class: JClass,
    content: JString,
    title: JString,
) -> jstring {
    let service = with_service_or_throw!(env);
    let content = jni_arg!(env, content: String);
    let title = jni_arg!(env, title: String);
    let result = service.add_post(&content, Some(&title));
    jni_ret!(env, result => String)
}
```
