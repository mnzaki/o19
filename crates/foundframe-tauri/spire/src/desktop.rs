//! Desktop Platform Implementation - GENERATED by spire-loom
//!
//! On desktop, we initialize o19_foundframe directly and call into it.

use crate::spire::platform::SpireFoundframePlatformTrait;
use crate::spire::error::{Error, Result};
use crate::spire::models::*;
use serde::de::DeserializeOwned;
use tauri::{AppHandle, Manager, Runtime, plugin::PluginApi};

/// Initialize the desktop platform.
pub fn init<R: Runtime, C: DeserializeOwned>(
  app: &AppHandle<R>,
  _api: &PluginApi<R, C>,
) -> Result<DesktopPlatform<R>> {
  DesktopPlatform::new(app.clone())
}

/// Desktop platform implementation.
///
/// Holds the foundframe runtime and provides direct access to all operations.
pub struct DesktopPlatform<R: Runtime> {
  app_handle: AppHandle<R>,
}

impl<R: Runtime> DesktopPlatform<R> {
  fn new(app_handle: AppHandle<R>) -> Result<Self> {
    // TODO: Initialize o19_foundframe here
    Ok(Self { app_handle })
  }

  pub fn app_handle(&self) -> &AppHandle<R> {
    &self.app_handle
  }
}

impl<R: Runtime> SpireFoundframePlatformTrait for DesktopPlatform<R> {
  fn exit(&self, code: i32) {
    self.app_handle.exit(code);
  }

  fn request_permissions(&self) -> Result<NotificationPermissionStatus> {
    Ok(NotificationPermissionStatus {
      status: "granted".into(),
    })
  }

  fn shutdown(&self) -> Result<()> {
    // TODO: Shutdown o19_foundframe
    Ok(())
  }

  fn add_bookmark(
    &self,
        url: String,
        title: Option<String>,
        notes: Option<String>
    
  ) -> Result<String> {
    // TODO: Implement BookmarkMgmt.addBookmark
    Err(Error::Other("Not implemented".into()))
  }

  fn get_bookmark(
    &self,
        pkbUrl: String
    
  ) -> Result<String> {
    // TODO: Implement BookmarkMgmt.getBookmark
    Err(Error::Other("Not implemented".into()))
  }

  fn list_bookmarks(
    &self,
        directory: Option<String>
    
  ) -> Result<Vec<String>> {
    // TODO: Implement BookmarkMgmt.listBookmarks
    Err(Error::Other("Not implemented".into()))
  }

  fn delete_bookmark(
    &self,
        pkbUrl: String
    
  ) -> Result<bool> {
    // TODO: Implement BookmarkMgmt.deleteBookmark
    Err(Error::Other("Not implemented".into()))
  }

  fn generate_pairing_code(
    &self,
    
  ) -> Result<String> {
    // TODO: Implement DeviceMgmt.generatePairingCode
    Err(Error::Other("Not implemented".into()))
  }

  fn confirm_pairing(
    &self,
        deviceId: String,
        code: String
    
  ) -> Result<bool> {
    // TODO: Implement DeviceMgmt.confirmPairing
    Err(Error::Other("Not implemented".into()))
  }

  fn unpair_device(
    &self,
        deviceId: String
    
  ) -> Result<()> {
    // TODO: Implement DeviceMgmt.unpairDevice
    Err(Error::Other("Not implemented".into()))
  }

  fn list_paired_devices(
    &self,
    
  ) -> Result<Vec<String>> {
    // TODO: Implement DeviceMgmt.listPairedDevices
    Err(Error::Other("Not implemented".into()))
  }

  fn follow_device(
    &self,
        deviceId: String
    
  ) -> Result<bool> {
    // TODO: Implement DeviceMgmt.followDevice
    Err(Error::Other("Not implemented".into()))
  }

  fn unfollow_device(
    &self,
        deviceId: String
    
  ) -> Result<()> {
    // TODO: Implement DeviceMgmt.unfollowDevice
    Err(Error::Other("Not implemented".into()))
  }

  fn list_followers(
    &self,
    
  ) -> Result<Vec<String>> {
    // TODO: Implement DeviceMgmt.listFollowers
    Err(Error::Other("Not implemented".into()))
  }

  fn is_following(
    &self,
        deviceId: String
    
  ) -> Result<bool> {
    // TODO: Implement DeviceMgmt.isFollowing
    Err(Error::Other("Not implemented".into()))
  }

  fn subscribe_events(
    &self,
        callback: String
    
  ) -> Result<()> {
    // TODO: Implement EventMgmt.subscribeEvents
    Err(Error::Other("Not implemented".into()))
  }

  fn unsubscribe_events(
    &self,
        callback: String
    
  ) -> Result<()> {
    // TODO: Implement EventMgmt.unsubscribeEvents
    Err(Error::Other("Not implemented".into()))
  }

  fn supports_events(
    &self,
    
  ) -> Result<bool> {
    // TODO: Implement EventMgmt.supportsEvents
    Err(Error::Other("Not implemented".into()))
  }

}
