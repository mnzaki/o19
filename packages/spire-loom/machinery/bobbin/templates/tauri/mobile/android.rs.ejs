//! Android Platform Implementation - GENERATED by spire-loom
//!
//! Uses JNI calls to communicate with the <%= coreName %>-android service.
//! This implementation delegates all operations to the remote service.

use crate::spire::platform::<%= platformTraitName %>;
use crate::spire::error::{Error, Result};
use crate::spire::models::*;
use serde::de::DeserializeOwned;
use tauri::{AppHandle, Runtime, plugin::PluginApi};

/// Initialize the Android platform.
pub fn init<R: Runtime, C: DeserializeOwned>(
  app: &AppHandle<R>,
  _api: &PluginApi<R, C>,
  _plugin_handle: tauri::plugin::PluginHandle<R>,
) -> Result<AndroidPlatform<R>> {
  AndroidPlatform::new(app.clone())
}

/// Android platform implementation.
///
/// Connects to the <%= coreName %>-android service via JNI.
/// All operations are delegated to the remote service.
pub struct AndroidPlatform<R: Runtime> {
  app_handle: AppHandle<R>,
}

impl<R: Runtime> AndroidPlatform<R> {
  fn new(app_handle: AppHandle<R>) -> Result<Self> {
    // TODO: Connect to Android service via JNI
    Ok(Self { app_handle })
  }

  pub fn app_handle(&self) -> &AppHandle<R> {
    &self.app_handle
  }
}

impl<R: Runtime> <%= platformTraitName %> for AndroidPlatform<R> {
  fn exit(&self, code: i32) {
    self.app_handle.exit(code);
  }

  fn request_permissions(&self) -> Result<NotificationPermissionStatus> {
    // TODO: Call into Android plugin for actual permission request
    Ok(NotificationPermissionStatus {
      status: "granted".into(),
    })
  }

  fn shutdown(&self) -> Result<()> {
    // On Android, the service handles its own lifecycle
    tracing::info!("Android platform shutdown (service continues running)");
    Ok(())
  }

<% methods.forEach(function(method) { -%>
  fn <%= method.name %>(
    &self,
    <% method.params.forEach(function(param, idx) { -%>
    <%= param.name %>: <%- param.rsType %><% if (idx < method.params.length - 1) { %>,<% } %>
    <% }); %>
  ) -> Result<<%- method.rsReturnType %>> {
    // TODO: Call into <%= coreName %>-android service via JNI
    Err(Error::Other("Android not implemented".into()))
  }

<% }); -%>
}
