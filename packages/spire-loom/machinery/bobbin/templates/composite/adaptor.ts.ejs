/**
 * <%= managementName %> Composite Adaptor
 *
 * "The reed routes the warp through different heddles."
 *
 * This adaptor implements the <%= portName %> interface by routing
 * CRUD operations to different underlying adaptors:
 * - READ operations (get, list) → <%= readAdaptorName %> (Drizzle/SQLite)
 * - WRITE operations (create, update, delete) → <%= writeAdaptorName %> (Tauri/TheStream)
 *
 * Generated by spire-loom composite-adaptor treadle.
 * DO NOT EDIT DIRECTLY - Changes will be overwritten on next weave.
 */

import type { <%= portName %> } from '@o19/foundframe';
import type {
  <%= managementName %>,
  Create<%= managementName %>Input,
  Update<%= managementName %>Input,
  <%= managementName %>Filter,
  <%= managementName %>ListResult,
} from '@o19/foundframe';
import { <%= readAdaptorName %> } from '../drizzle/<%= managementName.toLowerCase() %>.adaptor';
import { <%= writeAdaptorName %> } from '../tauri/<%= managementName.toLowerCase() %>.adaptor';

/**
 * Composite adaptor for <%= managementName %> operations.
 *
 * Routes read operations to the Drizzle adaptor (fast SQLite queries)
 * and write operations to the Tauri adaptor (TheStream → PKB persistence).
 */
export class <%= managementName %>CompositeAdaptor implements <%= portName %> {
  constructor(
    private readAdaptor: <%= readAdaptorName %>,
    private writeAdaptor: <%= writeAdaptorName %>
  ) {}

  // ============================================================================
  // READ Operations → Drizzle → SQLite
  // ============================================================================
<% methods.filter(m => m.target === 'read').forEach(method => { %>
  /**
   * <%= method.operation.toUpperCase() %> operation - routed to <%= readAdaptorName %>
   */
  async <%= method.name %>(
<% method.params.forEach((param, i) => { %>
    <%= param.name %>: <%= param.type %><% if (i < method.params.length - 1) { %>,<% } %>
<% }); %>
  ): <%= method.returnType %> {
    return this.readAdaptor.<%= method.name %>(
<% method.params.forEach((param, i) => { %>
      <%= param.name %><% if (i < method.params.length - 1) { %>,<% } %>
<% }); %>
    );
  }
<% }); %>

  // ============================================================================
  // WRITE Operations → Tauri → TheStream → PKB
  // ============================================================================
<% methods.filter(m => m.target === 'write').forEach(method => { %>
  /**
   * <%= method.operation.toUpperCase() %> operation - routed to <%= writeAdaptorName %>
   *
   * This operation:
   * 1. Calls Tauri command
   * 2. TheStream persists to PKB (git)
   * 3. Event emitted to DbActor
   * 4. SQLite index updated
   * 5. Result returned through full circle
   */
  async <%= method.name %>(
<% method.params.forEach((param, i) => { %>
    <%= param.name %>: <%= param.type %><% if (i < method.params.length - 1) { %>,<% } %>
<% }); %>
  ): <%= method.returnType %> {
    return this.writeAdaptor.<%= method.name %>(
<% method.params.forEach((param, i) => { %>
      <%= param.name %><% if (i < method.params.length - 1) { %>,<% } %>
<% }); %>
    );
  }
<% }); %>
}

// ============================================================================
// Factory Function
// ============================================================================

/**
 * Create a <%= managementName %> composite adaptor.
 *
 * Usage:
 * ```typescript
 * const adaptor = create<%= managementName %>CompositeAdaptor(
 *   new <%= readAdaptorName %>(),
 *   new <%= writeAdaptorName %>()
 * );
 * ```
 */
export function create<%= managementName %>CompositeAdaptor(
  readAdaptor: <%= readAdaptorName %>,
  writeAdaptor: <%= writeAdaptorName %>
): <%= managementName %>CompositeAdaptor {
  return new <%= managementName %>CompositeAdaptor(readAdaptor, writeAdaptor);
}

// ============================================================================
// Re-export for convenience
// ============================================================================

export { <%= managementName %>CompositeAdaptor as default };
