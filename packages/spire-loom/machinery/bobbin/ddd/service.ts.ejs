<%
/**
 * DDD Service Template
 * Generates the service implementation for a management
 */
const service = locals.service;
const entityPascal = service.entityName;
const entityLower = service.entityName.toLowerCase();
-%>
/**
 * <%= service.serviceName %>
 * 
 * Domain service for <%= service.entityName %> operations.
 * Routes read operations to readAdaptor, write operations to writeAdaptor.
 * 
 * @generated by ddd-services treadle
 */

import type {
  <%= service.portName %>,
  <%= entityPascal %>ReadAdaptor,
  <%= entityPascal %>WriteAdaptor
} from '../../ports/gen/<%= entityLower %>.port.gen.js';

export class <%= service.serviceName %> implements <%= service.portName %> {
  constructor(
    private readAdaptor: <%= entityPascal %>ReadAdaptor,
    private writeAdaptor: <%= entityPascal %>WriteAdaptor
  ) {}

  // ============================================================================
  // Read Operations (via Kysely)
  // ============================================================================
<%_ for (const method of service.readMethods) { _%>

  async <%= method.camelName %>(
<%_   for (const param of method.params) { _%>
    <%= param.name %><%= param.optional ? '?' : '' %>: <%= param.tsType %>,
<%_   } _%>
  ): Promise<<%= method.returnType %><%= method.isCollection ? '[]' : '' %>> {
    return this.readAdaptor.<%= method.camelName %>(
<%_   for (const param of method.params) { _%>
      <%= param.name %>,
<%_   } _%>
    );
  }
<%_ } _%>

  // ============================================================================
  // Write Operations (via Tauri)
  // ============================================================================
<%_ for (const method of service.writeMethods) { _%>

  async <%= method.camelName %>(
<%_   for (const param of method.params) { _%>
    <%= param.name %><%= param.optional ? '?' : '' %>: <%= param.tsType %>,
<%_   } _%>
  ): Promise<<%= method.returnType %><%= method.isCollection ? '[]' : '' %>> {
    return this.writeAdaptor.<%= method.camelName %>(
<%_   for (const param of method.params) { _%>
      <%= param.name %>,
<%_   } _%>
    );
  }
<%_ } _%>

  // ============================================================================
  // Passthrough Operations (implementation-specific)
  // ============================================================================
<%_ for (const method of service.passthroughMethods) { _%>

  async <%= method.camelName %>(
<%_   for (const param of method.params) { _%>
    <%= param.name %><%= param.optional ? '?' : '' %>: <%= param.tsType %>,
<%_   } _%>
  ): Promise<<%= method.returnType %><%= method.isCollection ? '[]' : '' %>> {
    // Passthrough method - implement based on domain logic
    throw new Error('<%= method.name %> not implemented');
  }
<%_ } _%>
}
