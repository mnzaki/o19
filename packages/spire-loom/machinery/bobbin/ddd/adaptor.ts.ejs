<%
/**
 * DDD Adaptor Template
 * Generates adaptor implementations that wrap Kysely/Tauri
 */
const service = locals.service;
const entityPascal = service.entityName;
const entityLower = service.entityName.toLowerCase();
-%>
/**
 * <%= entityPascal %> Adaptor Implementations
 * 
 * Concrete adaptor implementations for <%= service.entityName %> operations.
 * - KyselyAdaptor: Read operations via Kysely (SQLite)
 * - TauriAdaptor: Write operations via Tauri commands (calls Rust core)
 * 
 * @generated by ddd-services treadle
 */

import { invoke } from '@tauri-apps/api/core';
import type { Kysely } from 'kysely';
import type { DB } from '../../db/types.js';
import type {
  <%= entityPascal %>ReadAdaptor,
  <%= entityPascal %>WriteAdaptor
} from '../../ports/gen/<%= entityLower %>.port.gen.js';

/**
 * Kysely-based read adaptor for <%= service.entityName %>
 */
export class <%= entityPascal %>KyselyAdaptor implements <%= entityPascal %>ReadAdaptor {
  constructor(private db: Kysely<DB>) {}

<%_ for (const method of service.readMethods) { _%>
  async <%= method.camelName %>(
<%_   for (const param of method.params) { _%>
    <%= param.name %><%= param.optional ? '?' : '' %>: <%= param.tsType %>,
<%_   } _%>
  ): Promise<<%= method.returnType %><%= method.isCollection ? '[]' : '' %>> {
    // TODO: Implement Kysely query
    // Example: return this.db.selectFrom('<%= entityLower %>').selectAll()...
    throw new Error('<%= method.name %> not yet implemented in Kysely adaptor');
  }

<%_ } _%>
}

/**
 * Tauri-based write adaptor for <%= service.entityName %>
 */
export class <%= entityPascal %>TauriAdaptor implements <%= entityPascal %>WriteAdaptor {
<%_ for (const method of service.writeMethods) { _%>

  async <%= method.camelName %>(
<%_   for (const param of method.params) { _%>
    <%= param.name %><%= param.optional ? '?' : '' %>: <%= param.tsType %>,
<%_   } _%>
  ): Promise<<%= method.returnType %><%= method.isCollection ? '[]' : '' %>> {
    return invoke('<%= method.name.replace(/_/g, '_') %>', {
<%_   for (const param of method.params) { _%>
      <%= param.name %>,
<%_   } _%>
    });
  }
<%_ } _%>
}
